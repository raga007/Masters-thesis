\chapter{Experiments}
\label{ch:evaluation}
To demonstrate the potential benefits of the two techniques we
introduced in Chapters~\ref{ch:adding-reflection} and~\ref{ch:static-analysis}, we
next present experimental results that show how the behavior of the
standard Korat technique~\cite{boyapati2002korat} is affected when
(1)~reflection is used for accessing fields in \emph{RepOk}
(Section~\ref{sec:generation-of-valid-structures}); and (2)~\emph{RepOk} makes extraneous field
accesses (Section~\ref{sec:performance-of-inefficient-predicates}).  As subjects, we use four
standard data structures (Section~\ref{sec:benchmarks}).
We performed all experiments on a Macbook running OSX with a 2.7GHz,
Intel core i7 processor using Sunâ€™s Java 6 SDK 1.6.0 JVM.


\section{Benchmarks}
\label{sec:benchmarks}

\para
The following list summarizes our subject data structures: 
\begin{itemize}
\item BinaryTree -- acyclic, binary trees with size field;
\item RedBlackTree -- acyclic, binary search trees with size field and
  (red/black) colored nodes.
\item SinglyLinkedList -- acyclic, singly-linked list with size field;
\item SortedList -- acyclic, singly-linked list with size field and
  integer elements in sorted order.
\end{itemize}
Table~\ref{fig:benchmarksAndFinitizationParams} lists the finitization parameters for each subject.


\begin{table}[h]
\resizebox{\columnwidth}{!}{\begin{tabular}{|c|c|}
\hline
\textit{Benchmark}    & \textit{Finitization parameters}       \\ \hline
\textit{BinaryTree}   &  \texttt{numNodes, minSize, maxSize}             \\ \hline
\textit{RedBlackTree} &  \texttt{numEntries, minSize, maxSize, numKeys}  \\ \hline
\textit{SinglyLinkedList}   &  \texttt{numEntries, minSize, maxSize}           \\ \hline
\textit{SortedList}   &  \texttt{numEntries, minSize, maxSize, numElems} \\ \hline
\end{tabular}}
\caption{Benchmarks and finitization parameters. Each benchmark is
  named after the class for which data structures are generated; the
  structures also contain objects from other classes.}
\label{fig:benchmarksAndFinitizationParams}
\end{table}


\section{Generation of valid structures}
\label{sec:generation-of-valid-structures}
%\FIX{
For each benchmark shown in Section~\ref{sec:benchmarks}, we set all
finitization parameters such that Korat generates structures of upto the
given \emph{size}. We set the \emph{maxSize} and other maximum
parameters to the value of \emph{size} (also known as \emph{scope})
and \emph{minSize} to 0. For a range of sizes and four different
\emph{RepOk} implementations, we tabulate the number of candidate
structures that Korat evaluates, the number of valid structures that
Korat generates and the time Korat takes to output the valid
structures. Table~\ref{fig:resultsTable} presents the results for
generating valid structures for our benchmark suite, using Korat
without reflection support.
%}

\par
\noindent The following list describes the various kinds of RepOk
methods we use for evaluation:
\begin{itemize}
\item No reflection -- standard \emph{RepOk} implementation (from the
  Korat distribution), which does not use the Java reflection API for
  any of the field accesses;
\item Reflection for \emph{root/header} field access -- \emph{RepOk}
  uses reflection only to access the \emph{root/header} field, which
  is typically accessed during the initial part of a RepOk's
  execution;
\item Reflection for \emph{size} field access -- \emph{RepOk} uses
  reflection only to access the \emph{size} field, which is typically
  accessed during the final part of a RepOk's execution; and
\item Reflection for a \emph{recursive} field access -- \emph{RepOk}
  uses reflection only to access a \emph{recursive} field, which is
  typically accessed multiple times by RepOk.
\end{itemize}

%\FIX{
\para The results in Table~\ref{fig:resultsTable} show that korat is
affected differently when reflection is used to access different
fields. In cases where reflection is used to access a field early in
the \emph{RepOk}, the Korat search terminates in under a second and
outputs up to 2 valid structures for the given scopes. In the
\emph{RepOk} where the \emph{size} field accessed using reflection,
Korat evaluates a significantly higher number of candidate structures
but, only outputs very few valid structures. This shows how the Korat
search is affected differently based on the field accessed using
reflection. Korat will be generate all valid non-isomorphic structures
efficiently after we add reflection support to it as discussed in
Chapter~\ref{ch:adding-reflection}.
%}


\begin{table}[h]
\centering
\resizebox{\columnwidth}{!}{\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
 & \multicolumn{3}{c|}{\textit{\begin{tabular}[c]{@{}c@{}}No reflection - \# of \\ structures\\ explored/valid\end{tabular}}} & \multicolumn{3}{c|}{\textit{\begin{tabular}[c]{@{}c@{}}Reflection for \\ ``root/header'' field \\ access - \# of structures\\ explored/valid\end{tabular}}} & \multicolumn{3}{c|}{\textit{\begin{tabular}[c]{@{}c@{}}Reflection for\\  ``size'' field access - \# of\\  structures\\ explored/valid\end{tabular}}} & \multicolumn{3}{c|}{\textit{\begin{tabular}[c]{@{}c@{}}Reflection for a \\ recursive field \\ access - \# of structures\\ explored/valid\end{tabular}}} \\ \hline
\textit{Scope size} & 5 & 6 & 7 & 5 & 6 & 7 & 5 & 6 & 7 & 5 & 6 & 7 \\ \hline
\textit{BinaryTree} & \begin{tabular}[c]{@{}c@{}}1272/\\ 65\end{tabular} & \begin{tabular}[c]{@{}c@{}}4835/\\ 197\end{tabular} & \begin{tabular}[c]{@{}c@{}}18474/\\ 626\end{tabular} & \begin{tabular}[c]{@{}c@{}}7/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}8/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}9/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}952/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}3659/\\ 7\end{tabular} & \begin{tabular}[c]{@{}c@{}}14099/\\ 8\end{tabular} & \begin{tabular}[c]{@{}c@{}}9/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}10/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}11/\\ 2\end{tabular} \\ \hline
\textit{RedBlackTree} & \begin{tabular}[c]{@{}c@{}}6073/\\ 115\end{tabular} & \begin{tabular}[c]{@{}c@{}}25938/\\ 327\end{tabular} & \begin{tabular}[c]{@{}c@{}}112012/\\ 911\end{tabular} & \begin{tabular}[c]{@{}c@{}}9/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}10/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}11/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}1387/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}4958/\\ 7\end{tabular} & \begin{tabular}[c]{@{}c@{}}18769/\\ 8\end{tabular} & \begin{tabular}[c]{@{}c@{}}16/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}18/\\ 7\end{tabular} & \begin{tabular}[c]{@{}c@{}}20/\\ 8\end{tabular} \\ \hline
\textit{SinglyLinkedList} & \begin{tabular}[c]{@{}c@{}}51/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}70/\\ 7\end{tabular} & \begin{tabular}[c]{@{}c@{}}92/\\ 8\end{tabular} & \begin{tabular}[c]{@{}c@{}}7/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}8/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}9/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}26/\\ 1\end{tabular} & \begin{tabular}[c]{@{}c@{}}34/\\ 1\end{tabular} & \begin{tabular}[c]{@{}c@{}}43/\\ 1\end{tabular} & \begin{tabular}[c]{@{}c@{}}9/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}10/\\ 2\end{tabular} & \begin{tabular}[c]{@{}c@{}}11/\\ 2\end{tabular} \\ \hline
\textit{SortedList} & \begin{tabular}[c]{@{}c@{}}891/\\ 252\end{tabular} & \begin{tabular}[c]{@{}c@{}}4030/\\ 924\end{tabular} & \begin{tabular}[c]{@{}c@{}}18110/\\ 3432\end{tabular} & \begin{tabular}[c]{@{}c@{}}11/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}13/\\ 7\end{tabular} & \begin{tabular}[c]{@{}c@{}}15/\\ 8\end{tabular} & \begin{tabular}[c]{@{}c@{}}26/\\ 1\end{tabular} & \begin{tabular}[c]{@{}c@{}}34/\\ 1\end{tabular} & \begin{tabular}[c]{@{}c@{}}43/\\ 1\end{tabular} & \begin{tabular}[c]{@{}c@{}}13/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}15/\\ 7\end{tabular} & \begin{tabular}[c]{@{}c@{}}17/\\ 8\end{tabular} \\ \hline
\end{tabular}}
\caption{Number of valid structures generated by Korat when reflection is used for field accesses. All maximum finitization parameters are set to the size value.}
\label{fig:resultsTable}
\end{table}




\section{Performance of Inefficient predicates}
\label{sec:performance-of-inefficient-predicates}

% This table has been revised and every value has been verified
\begin{table}[h]
\resizebox{\columnwidth}{!}{\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
 & \multicolumn{3}{c|}{\textit{\begin{tabular}[c]{@{}c@{}}\# of structures \\ explored/valid \\ with an \\ efficient RepOk\end{tabular}}} & \multicolumn{3}{c|}{\textit{\begin{tabular}[c]{@{}c@{}}Execution time\\ (in sec)\end{tabular}}} & \multicolumn{3}{c|}{\begin{tabular}[c]{@{}c@{}}\# of structures \\ explored/valid \\ with an \\ Inefficient RepOK\end{tabular}} & \multicolumn{3}{c|}{\textit{\begin{tabular}[c]{@{}c@{}}Execution time\\ (in sec)\end{tabular}}} \\ \hline
\textit{Scope size} & 4 & 5 & 6 & 4 & 5 & 6 & 4 & 5 & 6 & 4 & 5 & 6 \\ \hline
\textit{BinaryTree} & \begin{tabular}[c]{@{}c@{}}337/\\ 23\end{tabular} & \begin{tabular}[c]{@{}c@{}}1272/\\ 65\end{tabular} & \begin{tabular}[c]{@{}c@{}}4835/\\ 197\end{tabular} & 0.21 & 0.24 & 0.35 & \begin{tabular}[c]{@{}c@{}}105455/\\ 23\end{tabular} & \begin{tabular}[c]{@{}c@{}}3922746/\\ 65\end{tabular} & \begin{tabular}[c]{@{}c@{}}171432317/\\ 197\end{tabular} & 0.48 & 2.64 & 118.15 \\ \hline
\textit{LinkedList} & \begin{tabular}[c]{@{}c@{}}35/\\ 5\end{tabular} & \begin{tabular}[c]{@{}c@{}}51/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}70/\\ 7\end{tabular} & 0.18 & 0.19 & 0.20 & \begin{tabular}[c]{@{}c@{}}75/\\ 5\end{tabular} & \begin{tabular}[c]{@{}c@{}}126/\\ 6\end{tabular} & \begin{tabular}[c]{@{}c@{}}196/\\ 7\end{tabular} & 0.18 & 0.19 & 0.19 \\ \hline
\textit{SortedList} & \begin{tabular}[c]{@{}c@{}}203/\\ 70\end{tabular} & \begin{tabular}[c]{@{}c@{}}891/\\ 252\end{tabular} & \begin{tabular}[c]{@{}c@{}}4030/\\ 924\end{tabular} & 0.21 & 0.24 & 0.30 & \begin{tabular}[c]{@{}c@{}}411/\\ 70\end{tabular} & \begin{tabular}[c]{@{}c@{}}4026/\\ 252\end{tabular} & \begin{tabular}[c]{@{}c@{}}56176/\\ 924\end{tabular} & 0.22 & 0.28 & 0.45 \\ \hline
\textit{RedBlackTree} & \begin{tabular}[c]{@{}c@{}}1270/\\ 41\end{tabular} & \begin{tabular}[c]{@{}c@{}}6073/\\ 115\end{tabular} & \begin{tabular}[c]{@{}c@{}}25938/\\ 327\end{tabular} & 0.38 & 0.50 & 0.58 & \begin{tabular}[c]{@{}c@{}}684967/\\ 41\end{tabular} & \begin{tabular}[c]{@{}c@{}}31247487/\\ 115\end{tabular} & \begin{tabular}[c]{@{}c@{}}1629892151/\\ 327\end{tabular} & 1.28 & 24.73 & 2251.12 \\ \hline
\end{tabular}}
\caption{Number of valid structures generated by Korat when an inefficient predicate is used. All maximum finitization parameters are set to the size value. Time is elapsed real time in seconds.}
\label{fig:peformanceResultsTable}
\end{table}
